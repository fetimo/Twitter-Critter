<div id="content">
<?r unless @critter.nil? ?>
	<div class="preloader_container"><img class="loader" src="../images/spinner.gif"></div>
	<canvas id="your-critter" class="critter_container" width="1000" height="430">Critter requires canvas, upgrade to a nice browser.</canvas>
</div>
	<?r if session[:access_token] and @username === session[:access_token].params[:screen_name] ?>
<!--<div class="friends_tab">
	<ul>
		<li><a href="#">Fisticuffs</a></li>
		<li><a href="#">Hug</a></li>
	</ul>
</div>-->
<section class="friends">
		<?r if session[:friends].count > 4 ?>
	<div id="left_scroll"><img src="../images/back.png" alt="Backwards"></div>
		<?r end ?>
	<div id="carousel_inner">  
    	<ul> 
			<?r session[:friends].sort.each do |f| #from http://blog.xambr.com/2009/11/26/ramaze-partials-with-etanni/ ?>
		    	#{ render_partial :friend, { :friend=>f } }
			<?r end ?>
			<?r if @suggested_friend ?>
				<p>You look a bit lonely,<br>why not make a Critter for <a href="/user/#{@suggested_friend['username']}">#{@suggested_friend['name']}</a>?</p>
			<?r end ?>
		</ul>
	</div>
		<?r if session[:friends].count > 4 ?>
	<div id='right_scroll'><img src="../images/next.png" alt="Forwards"></div>
		<?r end ?>
</section>
<!--<section class="weapon_selection">
	<ul>
		<li><img src="../images/weapons/1.png"></li>
		<li><img src="../images/weapons/2.png"></li>
		<li><img src="../images/weapons/3.png"></li>
	</ul>
</section>-->
	<?r end ?>
<!-- load libraries -->
#{js('jquery')}
#{js('easel/lib/easel')}
#{js('easel/src/easeljs/filters/Filter')}
#{js('easel/src/easeljs/filters/ColorFilter')}
#{js('jquery-ui')}
#{js('underscore')}
#{js('backbone')}
<!-- app logic -->
#{js('carousel')}
#{js('animation')}
#{js('your-critter')}
<script>
/*
	Setup Critter model, url defaults to the username requested
*/
var Critter = Backbone.Model.extend({
	initialize: function (username) {
		this.fetch({url:'../api/critters/'+username});
	}
});
var	your_critter = new Critter('#{@username}'),
	elem = document.getElementById('your-critter'),
	stage = new Stage(elem),
	friend_stage = new Stage(elem);
friend_stage.autoClear = false;
build(your_critter);
</script>
#{js('friends')}
<?r else ?>
<p>No Critter called #{@username} exists yet! You can <a href="/user/#{@username}">give life to it though</a>.</p>
<?r end ?>